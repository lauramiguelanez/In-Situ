(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{109:function(e,t,n){e.exports=n.p+"static/media/scope white.7492596f.png"},110:function(e,t){t.COORDINATES={lat:41.404682,lng:2.123773},t.API_CONFIG={key:"AIzaSyA2VCIDASPyZRdr58uKR5ucueARsagOD6s",language:"es"},t.resetMarkerAnimation=function(e){window.setTimeout(function(){e.setAnimation(null)},3e4)},t.STYLES=[{featureType:"all",elementType:"geometry",stylers:[{color:"#a7e1c8"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{gamma:.01},{lightness:20}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{saturation:-31},{lightness:-33},{weight:2},{gamma:.8}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry",stylers:[{lightness:30},{saturation:30}]},{featureType:"poi",elementType:"geometry",stylers:[{saturation:20}]},{featureType:"poi.park",elementType:"geometry",stylers:[{lightness:20},{saturation:-20}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:10},{saturation:-30}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{saturation:25},{lightness:25}]},{featureType:"water",elementType:"all",stylers:[{lightness:-20}]}]},111:function(e,t,n){e.exports=n(241)},204:function(e,t,n){},214:function(e,t,n){},241:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(48),i=n.n(r),s=(n(202),n(204),n(27)),c=n(3),l=n(4),u=n(6),d=n(5),m=n(7),p=n(246),h=n(242),g=(n(206),n(214),n(19)),f=n(216),v=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleLogout=function(e){n.props.logout()},n.state={loggedInUser:null},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState(Object(g.a)({},this.state,{loggedInUser:e.userInSession}))}},{key:"render",value:function(){var e=this.props.page;return console.log("Page in navBar "+e),this.state.loggedInUser&&"Profile"==e?o.a.createElement("nav",{className:"nav-style box",id:"top-nav"},o.a.createElement("ul",{className:"nav-width"},o.a.createElement("li",{className:"has-text-danger"},o.a.createElement(f.a,{to:"/"},o.a.createElement("img",{className:"profile-pic",src:"/Scope.svg"}))),o.a.createElement("li",null,o.a.createElement("a",{onClick:this.handleLogout},"Logout")),o.a.createElement("li",null,o.a.createElement(f.a,{to:"/profile"}," @",this.state.loggedInUser.username)))):this.state.loggedInUser&&"ProfileID"==e?o.a.createElement("nav",{className:"nav-style box",id:"top-nav"},o.a.createElement("ul",{className:"nav-width"},o.a.createElement("li",{className:"has-text-danger"},o.a.createElement(f.a,{to:"/"},o.a.createElement("img",{className:"profile-pic",src:"/Scope.svg"}))),o.a.createElement("li",null,o.a.createElement(f.a,{to:"/profile"},o.a.createElement("img",{className:"profile-pic",src:"/user.svg"}))))):this.state.loggedInUser?o.a.createElement("nav",{className:"nav-style box",id:"top-nav"},o.a.createElement("ul",{className:"nav-width"},o.a.createElement("li",{className:"has-text-danger"},o.a.createElement(f.a,{to:"/"},o.a.createElement("img",{className:"profile-pic",src:"/Scope.svg"}))),o.a.createElement("li",null,o.a.createElement(f.a,{to:"/profile"},o.a.createElement("img",{className:"profile-pic",src:"/user.svg"}))))):o.a.createElement("nav",{className:"nav-style box",id:"top-nav",role:"navigation","aria-label":"main navigation"},o.a.createElement("ul",{className:"nav-width"},o.a.createElement("li",null,o.a.createElement(f.a,{to:"/"},"Home")),o.a.createElement("li",null,o.a.createElement(f.a,{to:"/signup"},"Signup")),o.a.createElement("li",null,o.a.createElement(f.a,{to:"/login"},"Login"))))}}]),t}(a.Component),w=n(11),E=n.n(w);n(21).config();var b=function e(){var t=this;Object(c.a)(this,e),this.signup=function(e,n){return t.service.post("/signup",{username:e,password:n}).then(function(e){return e.data})},this.login=function(e,n){return t.service.post("/login",{username:e,password:n}).then(function(e){return e.data})},this.loggedin=function(){return t.service.get("/currentuser").then(function(e){return e.data}).catch(function(e){console.error("Error in getUser",e)})},this.logout=function(){return t.service.get("/logout").then(function(e){return e.data})},this.service=E.a.create({baseURL:"".concat("https://in-situ.herokuapp.com","/api/auth"),withCredentials:!0})},S=n(245),y=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleFormSubmit=function(e){e.preventDefault();var t=n.state.username,a=n.state.password;n.service.signup(t,a).then(function(e){n.setState({username:"",password:"",redirect:!0}),n.props.getUser(e.user)}).catch(function(e){return console.log(e)})},n.handleChange=function(e){var t=e.target,a=t.name,o=t.value;n.setState(Object(s.a)({},a,o))},n.state={username:"",password:"",redirect:!1},n.service=new b,n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return this.state.redirect?o.a.createElement(S.a,{to:"/"}):o.a.createElement("div",{className:"card box"},o.a.createElement("h3",{class:"label is-medium"},"Welcome! create your account next:"),o.a.createElement("form",{onSubmit:this.handleFormSubmit},o.a.createElement("div",{className:"field"},o.a.createElement("label",{className:"label"},"Username:"),o.a.createElement("input",{className:"input",type:"text",name:"username",value:this.state.username,onChange:function(t){return e.handleChange(t)}})),o.a.createElement("div",{className:"field"},o.a.createElement("label",{className:"label"},"Password:"),o.a.createElement("input",{className:"input",type:"password",name:"password",value:this.state.password,onChange:function(t){return e.handleChange(t)}})),o.a.createElement("input",{className:"button is-primary is-rounded",type:"submit",value:"Sign up"})))}}]),t}(a.Component),O=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleFormSubmit=function(e){e.preventDefault();var t=n.state.username,a=n.state.password;n.service.login(t,a).then(function(e){n.setState({username:t,password:a,error:!1,redirect:!0}),n.props.getUser(e)}).catch(function(e){n.setState({username:t,password:a,error:!0})})},n.handleChange=function(e){var t=e.target,a=t.name,o=t.value;n.setState(Object(s.a)({},a,o))},n.state={username:"",password:"",redirect:!1},n.service=new b,n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return this.state.redirect?o.a.createElement(S.a,{to:"/"}):o.a.createElement("div",{className:"card box"},o.a.createElement("h3",{className:"label is-medium"},"Please, login"),o.a.createElement("form",{onSubmit:this.handleFormSubmit},o.a.createElement("div",{className:"field"},o.a.createElement("label",{className:"label"},"Username:"),o.a.createElement("input",{className:"input",type:"text",name:"username",value:this.state.username,onChange:function(t){return e.handleChange(t)}})),o.a.createElement("div",{className:"field"},o.a.createElement("label",{className:"label"},"Password:"),o.a.createElement("input",{className:"input",type:"password",name:"password",value:this.state.password,onChange:function(t){return e.handleChange(t)}})),o.a.createElement("input",{className:"button is-primary is-rounded",type:"submit",value:"Login"})),o.a.createElement("h1",null,this.state.error?"Error":""))}}]),t}(a.Component),C=n(2),j=n(2);j.DeviceOrientationControls=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var n=function(e){t.deviceOrientation=e},a=function(){t.screenOrientation=window.orientation||0},o=function(){var e=new j.Vector3(0,0,1),t=new j.Euler,n=new j.Quaternion,a=new j.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(o,r,i,s,c){t.set(i,r,-s,"YXZ"),o.setFromEuler(t),o.multiply(a),o.multiply(n.setFromAxisAngle(e,-c))}}();this.connect=function(){a(),window.addEventListener("orientationchange",a,!1),window.addEventListener("deviceorientation",n,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",a,!1),window.removeEventListener("deviceorientation",n,!1),t.enabled=!1},this.update=function(){var e;if(!1!==t.enabled){var n=t.deviceOrientation;if(e=window.screen.width<=740?0:90,n){var a=n.alpha?j.Math.degToRad(n.alpha)+t.alphaOffset:0,r=n.beta?j.Math.degToRad(n.beta+e):j.Math.degToRad(e),i=n.gamma?j.Math.degToRad(n.gamma):0,s=t.screenOrientation?j.Math.degToRad(t.screenOrientation):0;o(t.object.quaternion,a,r,i,s)}}},this.dispose=function(){t.disconnect()},this.connect()};var I=j.DeviceOrientationControls,N=n(2);N.CSS3DRenderer=function(){var e,t,n,a;console.log("THREE.CSS3DRenderer",N.REVISION);var o=new N.Matrix4,r={camera:{fov:0,style:""},objects:new WeakMap},i=document.createElement("div");i.style.overflow="hidden",this.domElement=i;var s=document.createElement("div");s.style.WebkitTransformStyle="preserve-3d",s.style.transformStyle="preserve-3d",i.appendChild(s);var c=/Trident/i.test(navigator.userAgent);function l(e){return Math.abs(e)<1e-10?0:e}function u(e){var t=e.elements;return"matrix3d("+l(t[0])+","+l(-t[1])+","+l(t[2])+","+l(t[3])+","+l(t[4])+","+l(-t[5])+","+l(t[6])+","+l(t[7])+","+l(t[8])+","+l(-t[9])+","+l(t[10])+","+l(t[11])+","+l(t[12])+","+l(-t[13])+","+l(t[14])+","+l(t[15])+")"}function d(e,t){var o=e.elements,r="matrix3d("+l(o[0])+","+l(o[1])+","+l(o[2])+","+l(o[3])+","+l(-o[4])+","+l(-o[5])+","+l(-o[6])+","+l(-o[7])+","+l(o[8])+","+l(o[9])+","+l(o[10])+","+l(o[11])+","+l(o[12])+","+l(o[13])+","+l(o[14])+","+l(o[15])+")";return c?"translate(-50%,-50%)translate("+n+"px,"+a+"px)"+t+r:"translate(-50%,-50%)"+r}this.getSize=function(){return{width:e,height:t}},this.setSize=function(o,r){n=(e=o)/2,a=(t=r)/2,i.style.width=o+"px",i.style.height=r+"px",s.style.width=o+"px",s.style.height=r+"px"};var m=function(){var e=new N.Vector3,t=new N.Vector3;return function(n,a){return e.setFromMatrixPosition(n.matrixWorld),t.setFromMatrixPosition(a.matrixWorld),e.distanceToSquared(t)}}();function p(e){for(var t=function(e){var t=[];return e.traverse(function(e){e instanceof N.CSS3DObject&&t.push(e)}),t}(e).sort(function(e,t){return r.objects.get(e).distanceToCameraSquared-r.objects.get(t).distanceToCameraSquared}),n=t.length,a=0,o=t.length;a<o;a++)t[a].element.style.zIndex=n-a}this.render=function(e,t){var l=t.projectionMatrix.elements[5]*a;r.camera.fov!==l&&(t.isPerspectiveCamera&&(i.style.WebkitPerspective=l+"px",i.style.perspective=l+"px"),r.camera.fov=l),e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld();var h=t.isOrthographicCamera?"scale("+l+")"+u(t.matrixWorldInverse):"translateZ("+l+"px)"+u(t.matrixWorldInverse),g=h+"translate("+n+"px,"+a+"px)";r.camera.style===g||c||(s.style.WebkitTransform=g,s.style.transform=g,r.camera.style=g),function e(t,n,a){if(t instanceof N.CSS3DObject){var i;t instanceof N.CSS3DSprite?(o.copy(n.matrixWorldInverse),o.transpose(),o.copyPosition(t.matrixWorld),o.scale(t.scale),o.elements[3]=0,o.elements[7]=0,o.elements[11]=0,o.elements[15]=1,i=d(o,a)):i=d(t.matrixWorld,a);var l=t.element,u=r.objects.get(t);if(void 0===u||u!==i){l.style.WebkitTransform=i,l.style.transform=i;var p={style:i};c&&(p.distanceToCameraSquared=m(n,t)),r.objects.set(t,p)}l.parentNode!==s&&s.appendChild(l)}for(var h=0,g=t.children.length;h<g;h++)e(t.children[h],n,a)}(e,t,h),c&&p(e)}};var D=N.CSS3DRenderer,k=n(2);(k=n(2)).CSS3DObject=function(e){k.Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})},k.CSS3DObject.prototype=Object.create(k.Object3D.prototype),k.CSS3DObject.prototype.constructor=k.CSS3DObject,k.CSS3DSprite=function(e){k.CSS3DObject.call(this,e)},k.CSS3DSprite.prototype=Object.create(k.CSS3DObject.prototype),k.CSS3DSprite.prototype.constructor=k.CSS3DSprite;var M=function(e,t,n,a,o){var r=document.createElement("div");r.style.width="".concat(200,"px"),r.style.backgroundColor="#000";var i=document.createElement("iframe");i.style.border="0px";var s=["https://www.youtube.com/embed/",e,"?rel=0"].join("");i.src=s,r.appendChild(i);var c=new k.CSS3DObject(r);return c.position.set(t,n,a),c.rotation.y=o,console.log(e),console.log(s),c},T=function(e,t,n,a,o){var r=document.createElement("div");r.style.backgroundColor="#000";var i=document.createElement("img");i.style.border="0px",i.src=e,i.style.width="".concat(200,"px"),i.style.height="auto",r.appendChild(i);var s=new k.CSS3DObject(r);return s.position.set(t,n,a),s.rotation.y=o,console.log(e),s},x=function(e,t){var n,a,o=e-50,r=t.length,i=2*Math.PI/r,s=new k.Group;return t.forEach(function(e,t){var r=i*t;n=o*Math.cos(r),a=o*Math.sin(r);var c=3*Math.PI/2-r;if("IMAGE"==e.type){var l=new T(e.url,n,0,a,c);s.add(l)}else if("YOUTUBE"==e.type){var u=new M(e.url,n,0,a,c);s.add(u)}else{var d=new M(e,n,0,a,c);s.add(d)}}),s};n(21).config();var P=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).getImage=function(e){return n.service.get("/spaces/".concat(e)).then(function(e){console.log("Image from DB "+e.data),n.setState({image:e.data.image,media:e.data.media})}).catch(function(e){return console.log(e)})},n.init=function(e){var t=e.camera,a=e.scene,o=e.renderer,r=e.sceneCSS,i=e.rendererCSS;n.setState({controls:new I(t)}),t.position.set(0,0,-1e-4),o.domElement.className="scope",i.domElement.className="scopeCSS";var s=new C.SphereBufferGeometry(n.state.spaceRadius,60,40);s.scale(-1,1,1);var c=new C.TextureLoader;c.crossOrigin="";var l=c.load(n.state.image),u=new C.MeshBasicMaterial({map:l}),d=new C.Mesh(s,u);a.add(d);var m=new C.BoxBufferGeometry(100,100,100,4,4,4),p=new C.MeshBasicMaterial({color:16711935,wireframe:!0});new C.Mesh(m,p);console.log("MEDIA FROM THIS SPACE DB"),console.log(n.state.media);var h=x(n.state.spaceRadius,n.state.media);r.add(h);var g=document.getElementById("scopediv");o.setPixelRatio(window.devicePixelRatio),o.setSize(window.innerWidth,window.innerHeight),g.appendChild(o.domElement),i.setSize(window.innerWidth,window.innerHeight),g.appendChild(i.domElement),window.addEventListener("resize",n.onWindowResize,!1)},n.animate=function(){var e=n.state,t=e.camera,a=e.scene,o=e.renderer,r=e.sceneCSS,i=e.rendererCSS,s=e.controls;window.requestAnimationFrame(n.animate),s.update(),o.render(a,t),i.render(r,t)},n.onWindowResize=function(){var e=n.state,t=e.camera,a=e.renderer,o=e.rendererCSS;t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight),o.setSize(window.innerWidth,window.innerHeight)},n.componentDidMount=function(){var e=n.state.id;n.getImage(e).then(function(){n.init(n.state),n.animate()})},n.componentDidUpdate=function(e){if(n.props.id!==e.id){var t=n.props.id;n.setState({id:t}),n.getImage(t).then(function(){n.init(n.state),n.animate()})}},n.state={spaceRadius:500,camera:new C.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1100),scene:new C.Scene,sceneCSS:new C.Scene,renderer:new C.WebGLRenderer({antialias:!0}),rendererCSS:new D,id:n.props.id},n.service=E.a.create({baseURL:"".concat("https://in-situ.herokuapp.com","/api")}),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{id:"scopediv"})}}]),t}(o.a.Component),U=(a.Component,function(){return new Promise(function(e,t){navigator.geolocation||t("No geolocation available"),navigator.geolocation.getCurrentPosition(function(t){var n={lat:t.coords.latitude,lng:t.coords.longitude};e(n)},t)})});n(21).config();var R=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).createSpace=function(e,t){t.lat,t.lng;console.log(t);var a=n.state.loggedInUser;console.log("USER IN CREATE SPACE"),console.log(a);var o={image:e,creator:a._id,location:t};return n.service.post("/spaces",o).then(function(e){console.log("CREATED NEW SPACE:"),console.log(e.data),n.sendNewSpace(e.data),n.addSpaceToUser(e.data)}).catch(function(e){return console.log(e)})},n.sendNewSpace=function(e){n.props.newSpace(e._id,e.location)},n.addSpaceToUser=function(e){var t=n.state.loggedInUser;console.log("ADD TO USER CATALOG"),console.log(e),console.log(t),n.updateCatalog(t.catalog,e._id)},n.updateCatalog=function(e,t){var a={spaceId:t};return n.service.patch("/catalog/".concat(e),a).then(function(e){console.log("Catalog updated on DB "+e.data)}).catch(function(e){return console.log(e)})},n.state={loggedInUser:n.props.userInSession,redirect:!1},n.service=E.a.create({baseURL:"".concat("https://in-situ.herokuapp.com","/api")}),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState(Object(g.a)({},this.state,{loggedInUser:e.userInSession}))}},{key:"handleChange",value:function(e){this.setState({file:e.target.files[0]})}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),this.uploadImage(this.state.file).then(function(){console.log("uploaded image to create space"),console.log(t.state.img_url),U().then(function(e){console.log(e),t.createSpace(t.state.img_url,e)})})}},{key:"uploadImage",value:function(e){var t=this,n=new FormData;return n.append("photo",e),this.service.post("/uploadCloud",n,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.setState({img_url:e.data.secure_url,redirect:!0})}).catch(function(e){return console.log(e)})}},{key:"render",value:function(){var e=this;return this.state.redirect?o.a.createElement(S.a,{to:"/"}):o.a.createElement("div",{className:"form-card box"},o.a.createElement("div",{className:"file"},o.a.createElement("form",{onSubmit:function(t){return e.handleSubmit(t)}},o.a.createElement("label",{className:"file-label"},o.a.createElement("input",{className:"file-input",type:"file",onChange:function(t){return e.handleChange(t)}}),o.a.createElement("span",{className:"file-cta"},o.a.createElement("span",{className:"file-label"},"Take a panoramic photo"))),o.a.createElement("button",{className:"button is-primary",type:"submit"},"Upload"))))}}]),t}(o.a.Component);n(21).config();var L=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).createMedia=function(e){var t={url:e,type:"IMAGE"};return n.service.post("/media",t).then(function(e){console.log("CREATED NEW IMAGE:"),console.log(e.data),n.addMediaToSpace(e.data)}).catch(function(e){return console.log(e)})},n.addMediaToSpace=function(e){var t=n.state.spaceID;console.log("SPACE ID UPLOAD IMG "+t),n.updateSpace(e,t)},n.updateSpace=function(e,t){var a=e;return n.service.patch("/spaces/".concat(t),a).then(function(e){console.log("Space updated on DB "+e.data)}).catch(function(e){return console.log(e)})},n.state={loggedInUser:n.props.userInSession,spaceID:n.props.currentSpace,redirect:!1},n.service=E.a.create({baseURL:"".concat("https://in-situ.herokuapp.com","/api")}),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"handleChange",value:function(e){this.setState({file:e.target.files[0]})}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),this.uploadImage(this.state.file).then(function(){console.log("uploaded image to this space"),console.log(t.state.img_url),t.createMedia(t.state.img_url)})}},{key:"uploadImage",value:function(e){var t=this,n=new FormData;return n.append("photo",e),this.service.post("/uploadCloud",n,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.setState({img_url:e.data.secure_url,redirect:!0})}).catch(function(e){return console.log(e)})}},{key:"render",value:function(){var e=this;return console.log("SPACE ID UPLOAD IMG "+this.state.spaceID),this.state.redirect?o.a.createElement(S.a,{to:"/profile"}):o.a.createElement("div",{className:"form-card"},o.a.createElement("div",{className:"file"},o.a.createElement("form",{onSubmit:function(t){return e.handleSubmit(t)}},o.a.createElement("label",{className:"file-label"},o.a.createElement("input",{className:"file-input",type:"file",onChange:function(t){return e.handleChange(t)}})," ",o.a.createElement("br",null),o.a.createElement("span",{className:"file-cta"},o.a.createElement("span",{className:"file-label"},"Add an image to this Scope"))),o.a.createElement("button",{type:"submit",className:"button is-primary"},"Upload"))))}}]),t}(o.a.Component),A=n(2);(A=n(2)).CSS3DObject=function(e){A.Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})},A.CSS3DObject.prototype=Object.create(A.Object3D.prototype),A.CSS3DObject.prototype.constructor=A.CSS3DObject,A.CSS3DSprite=function(e){A.CSS3DObject.call(this,e)},A.CSS3DSprite.prototype=Object.create(A.CSS3DObject.prototype),A.CSS3DSprite.prototype.constructor=A.CSS3DSprite;var W=function(e,t,n,a,o){var r=document.createElement("div");r.style.width="".concat(200,"px"),r.style.backgroundColor="#000";var i=document.createElement("iframe");i.style.border="0px";var s=["https://www.youtube.com/embed/",e,"?rel=0"].join("");i.src=s,r.appendChild(i);var c=new A.CSS3DObject(r);return c.position.set(t,n,a),c.rotation.y=o,c},z=function(e,t,n,a,o){var r=document.createElement("div");r.style.backgroundColor="#000";var i=document.createElement("img");i.style.border="0px",i.src=e,i.style.width="".concat(200,"px"),i.style.height="auto",r.appendChild(i);var s=new A.CSS3DObject(r);return s.position.set(t,n,a),s.rotation.y=o,s},V=function(e,t,n,a,o){var r=document.createElement("div");r.className="div-on-scope";var i=document.createElement("h2");i.className="text-on-scope",i.innerHTML=e,r.appendChild(i);var s=new A.CSS3DObject(r);return s.position.set(t,n,a),s.rotation.y=o,s},H=function(e,t){var n=t,a=document.createElement("div"),o=document.createElement("BUTTON");o.className="button is-primary",o.id="like-button",o.style.borderRadius="30px",o.innerHTML="LIKE",o.style.width="60px",o.style.height="60px",a.appendChild(o);var r=new A.CSS3DObject(a);return r.position.set(0,n,0),r.rotation.x=-Math.PI/2,r.rotation.z=Math.PI,r},_=function(e,t,n){console.log("MEDIA SEND TO CSS ELEMENTS"),console.log(t);var a,o,r=e-50,i=t.length,s=2*Math.PI/i,c=new A.Group;return t.forEach(function(e,t){var i=s*t;a=r*Math.cos(i),o=r*Math.sin(i);var l=3*Math.PI/2-i;if("IMAGE"==e.type){var u=new z(e.url,a,0,o,l);c.add(u)}else if("YOUTUBE"==e.type){var d=new W(e.url,a,0,o,l);c.add(d)}else if("TEXT"==e.type){var m=new V(e.url,a,0,o,l);c.add(m)}else{console.log(e);var p=new W(e,a,0,o,l);c.add(p)}var h=new H(n,-r);c.add(h)}),c},B=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(u.a)(this,Object(d.a)(t).call(this))).cameraStart=function(){var t=document.querySelector("#camera--view");navigator.mediaDevices.getUserMedia(e.state.constraints).then(function(e){e.getTracks()[0];t.srcObject=e}).catch(function(e){console.error("Oops. Something is broken.",e)})},e.componentDidMount=function(){e.cameraStart()},e.state={cameraView:document.querySelector("#camera--view"),constraints:{video:{facingMode:"environment"},audio:!1}},e}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("video",{className:"camera",id:"camera--view",autoPlay:!0,playsInline:!0})}}]),t}(o.a.Component);n(21).config();o.a.Component;n(21).config();var F=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).getImage=function(e){var t=[];return n.service.get("/spaces/".concat(e)).then(function(e){n.setState({image:e.data.image,mediaIDs:e.data.media}),n.sendNewSpace(e.data),console.log("Image from DB "+e.data.image)}).then(function(){return n.state.mediaIDs.forEach(function(e){"object"==typeof e&&(e=e._id),t.push(n.service.get("/media/".concat(e)))}),Promise.all(t)}).then(function(e){var t=[];e.forEach(function(e){t.push(e.data)}),n.setState({media:t}),console.log("MEDIA OBJECTS IN STATE"),console.log(n.state.media)}).catch(function(e){return console.log(e)})},n.sendNewSpace=function(e){n.props.newSpace(e._id,e.location),n.props.newPage()},n.init=function(e){var t=e.camera,a=e.scene,o=e.renderer,r=e.sceneCSS,i=e.rendererCSS;n.setState({controls:new I(t)}),t.position.set(0,0,-1e-4),o.domElement.className="scopehidden",i.domElement.className="scopeCSS";var s=new C.SphereBufferGeometry(n.state.spaceRadius,60,40);s.scale(-1,1,1);var c=new C.TextureLoader;c.crossOrigin="";var l=c.load(n.state.image),u=new C.MeshBasicMaterial({map:l}),d=new C.Mesh(s,u);a.add(d);var m,p=n.state.media;console.log("MEDIA FROM THIS SPACE DB"),console.log(p),void 0!==p&&(m=_(n.state.spaceRadius,p),console.log(m),r.add(m));var h=document.getElementById("scopecamdiv");o.setPixelRatio(window.devicePixelRatio),o.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(o.domElement),h.appendChild(o.domElement),i.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(i.domElement),h.appendChild(i.domElement),window.addEventListener("resize",n.onWindowResize,!1)},n.animate=function(){var e=n.state,t=e.camera,a=e.scene,o=e.renderer,r=e.sceneCSS,i=e.rendererCSS,s=e.controls;window.requestAnimationFrame(n.animate),s.update(),o.render(a,t),i.render(r,t)},n.onWindowResize=function(){var e=n.state,t=e.camera,a=e.renderer,o=e.rendererCSS;t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight),o.setSize(window.innerWidth,window.innerHeight)},n.componentDidMount=function(){var e=n.props.match.params.id;n.setState({id:e}),n.getImage(e).then(function(){n.init(n.state),n.animate()})},n.state={spaceRadius:500,camera:new C.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1100),scene:new C.Scene,sceneCSS:new C.Scene,renderer:new C.WebGLRenderer({antialias:!0}),rendererCSS:new D},n.service=E.a.create({baseURL:"".concat("https://in-situ.herokuapp.com","/api")}),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.match.params.id;return console.log("id a route scope "+e),o.a.createElement("div",{id:"scopecamdiv"},o.a.createElement("button",{className:"button is-danger is-outlined is-rounded switch-button danger"},o.a.createElement(f.a,{to:"/scope/".concat(e)},"AR")),o.a.createElement(B,null))}}]),t}(o.a.Component);n(21).config();var Y=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleChange=function(e){console.log(e);var t=e.target.value;n.setState({youtubeID:t})},n.createMedia=function(e){var t={url:e,type:"YOUTUBE"};return n.service.post("/media",t).then(function(e){console.log("CREATED NEW YOUTUBE VIDEO:"),console.log(e.data),n.addMediaToSpace(e.data)}).catch(function(e){return console.log(e)})},n.addMediaToSpace=function(e){var t=n.state.spaceID;n.updateSpace(e,t)},n.updateSpace=function(e,t){var a=e;return n.service.patch("/spaces/".concat(t),a).then(function(e){console.log("Space updated on DB "+e.data)}).catch(function(e){return console.log(e)})},n.state={loggedInUser:n.props.userInSession,spaceID:n.props.currentSpace,youtubeID:"",redirect:!1},n.service=E.a.create({baseURL:"".concat("https://in-situ.herokuapp.com","/api")}),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"handleSubmit",value:function(e){e.preventDefault(),console.log("uploaded youtube video to this space"),console.log(this.state.img_url),this.createMedia(this.state.youtubeID),this.setState({redirect:!0})}},{key:"render",value:function(){var e=this;return console.log("SPACE ID UPLOAD VIDEO "+this.state.spaceID),this.state.redirect?o.a.createElement(S.a,{to:"/profile"}):o.a.createElement("div",{className:"form-card"},o.a.createElement("div",{class:"field"},o.a.createElement("form",{onSubmit:function(t){return e.handleSubmit(t)}},o.a.createElement("label",{class:"label"},"Add a YouTube video to this Scope"),o.a.createElement("div",{class:"control"},o.a.createElement("input",{className:"input is-primary",type:"text",name:"youtubeID",onChange:function(t){return e.handleChange(t)},placeholder:"VVsCOnWGHh8"})),o.a.createElement("button",{className:"button is-primary",type:"submit"},"Upload"))))}}]),t}(o.a.Component);n(21).config();var X=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleChange=function(e){console.log(e);var t=e.target.value;n.setState({text:t})},n.createMedia=function(e){var t={url:e,type:"TEXT"};return n.service.post("/media",t).then(function(e){console.log("CREATED NEW YOUTUBE VIDEO:"),console.log(e.data),n.addMediaToSpace(e.data)}).catch(function(e){return console.log(e)})},n.addMediaToSpace=function(e){var t=n.state.spaceID;n.updateSpace(e,t)},n.updateSpace=function(e,t){var a=e;return n.service.patch("/spaces/".concat(t),a).then(function(e){console.log("Space updated on DB "+e.data)}).catch(function(e){return console.log(e)})},n.state={loggedInUser:n.props.userInSession,spaceID:n.props.currentSpace,text:"",redirect:!1},n.service=E.a.create({baseURL:"".concat("https://in-situ.herokuapp.com","/api")}),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"handleSubmit",value:function(e){e.preventDefault(),console.log("uploaded youtube video to this space"),console.log(this.state.img_url),this.createMedia(this.state.text),this.setState({redirect:!0})}},{key:"render",value:function(){var e=this;return console.log("SPACE ID UPLOAD TEXT "+this.state.spaceID),this.state.redirect?o.a.createElement(S.a,{to:"/profile"}):o.a.createElement("div",{className:"form-card"},o.a.createElement("div",{class:"field"},o.a.createElement("form",{onSubmit:function(t){return e.handleSubmit(t)}},o.a.createElement("label",{class:"label"},"Add a quote to this Scope"),o.a.createElement("div",{class:"control"},o.a.createElement("input",{className:"input is-primary",type:"text",name:"youtubeID",onChange:function(t){return e.handleChange(t)},placeholder:"Say something"})),o.a.createElement("button",{className:"button is-primary",type:"submit"},"Upload"))))}}]),t}(o.a.Component),G=n(243),q=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={loggedInUser:null},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState(Object(g.a)({},this.state,{loggedInUser:e.userInSession}))}},{key:"render",value:function(){var e=this.props.page;return console.log("Page in bottomMenu "+e),"Scope"==e?o.a.createElement("div",null):this.state.loggedInUser&&"Scope"!==e?o.a.createElement("nav",{className:"nav-style box",id:"bottom-nav"},o.a.createElement(G.a,{className:"not-filled-feed",activeClassName:"filled-feed",to:"/feed"}),o.a.createElement(G.a,{className:"not-filled-add",to:"/upload-scope/"}),o.a.createElement(G.a,{className:"not-filled-explore",activeClassName:"filled-explore",to:"/explore"})):o.a.createElement("nav",{className:"nav-style box",id:"bottom-nav",role:"navigation","aria-label":"main navigation"},o.a.createElement(G.a,{className:"not-filled-add",to:"/upload-scope/"}))}}]),t}(a.Component);n(238);n(21).config();var Z=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).getScopes=function(){var e=n.props.userInSession.catalog,t=[];return n.setState({catalogId:e}),n.service.get("/catalog/".concat(e)).then(function(e){return e.data.spaces.forEach(function(e){t.push(n.service.get("/spaces/".concat(e)))}),Promise.all(t)}).then(function(e){var t=[];e.forEach(function(e){t.push(e.data)}),n.setState({userSpaces:t})}).catch(function(e){return console.log(e)})},n.state={loggedInUser:e.userInSession},n.service=E.a.create({baseURL:"".concat("https://in-situ.herokuapp.com","/api")}),n.getScopes(),n.props.newPage(),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState(Object(g.a)({},this.state,{loggedInUser:e.userInSession}))}},{key:"render",value:function(){if(this.props.userInSession){var e=this.state.userSpaces;return e?(e.forEach(function(e){}),o.a.createElement("div",{className:"profile-feed"},e.map(function(e){return o.a.createElement("div",{key:e._id,className:"scope-in-feed"},o.a.createElement(f.a,{to:"/scope/".concat(e._id)},o.a.createElement("img",{className:"panorama-feed",height:"50px",src:e.image})))}))):o.a.createElement("div",{className:"profile-feed"})}return o.a.createElement("div",null)}}]),t}(a.Component);n(21).config();var Q=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).getScopes=function(){var e=n.props.match.params.username,t=[];n.service.get("auth/user/".concat(e)).then(function(t){n.setState({userProfileID:t.data._id});var a=n.checkFollowing(t.data._id),o=t.data.catalog;return n.setState({catalogId:o,followed:a,profileUser:e}),n.service.get("/catalog/".concat(o))}).then(function(e){return e.data.spaces.forEach(function(e){t.push(n.service.get("/spaces/".concat(e)))}),Promise.all(t)}).then(function(e){var t=[];e.forEach(function(e){t.push(e.data)}),n.setState({userSpaces:t})}).catch(function(e){return console.log(e)})},n.checkFollowing=function(e){console.log("USER IN SESSION CHECK FOLLOWING"),console.log(n.state.loggedInUser.following);var t=n.state.loggedInUser.following,a=n.state.loggedInUser._id;return console.log(a,e),!!t&&t.includes(e)},n.followUser=function(e){var t=n.props.userInSession._id,a=n.checkFollowing(e),o={id:e};if(console.log("FRONT "+e),!0!==a)return n.service.patch("/auth/".concat(t),o).then(function(e){console.log("User updated on DB "+e.data)}).catch(function(e){return console.log(e)})},n.state={followed:!1},n.service=E.a.create({baseURL:"".concat("https://in-situ.herokuapp.com","/api")}),n.props.newPage(),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState(Object(g.a)({},this.state,{loggedInUser:e.userInSession})),this.getScopes()}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.followUser(this.state.userProfileID),this.setState({followed:!0})}},{key:"render",value:function(){var e,t,n=this,a=this.state.userSpaces;return console.log("is followed "+this.state.followed),e=this.state.followed?"button is-primary is-outlined follow-button":"button is-primary follow-button",t=this.state.followed?"Unfollow":"Follow",a?o.a.createElement("div",null,o.a.createElement("div",{className:"profile-user"},o.a.createElement("h1",{className:"profile-name"},"@",this.state.profileUser),o.a.createElement("form",{onSubmit:function(e){return n.handleSubmit(e)}},o.a.createElement("button",{className:e,type:"submit"},t))),o.a.createElement("div",{className:"profile-feed"},a.map(function(e){return o.a.createElement("div",{key:e._id,className:"scope-in-feed"},o.a.createElement(f.a,{to:"/scope/".concat(e._id)},o.a.createElement("img",{className:"panorama-feed",height:"50px",src:e.image})))}))):o.a.createElement("div",{className:"profile-feed"},o.a.createElement("h1",null,"Login to see profile"))}}]),t}(a.Component),K=n(2);K.TrackballControls=function(e,t){var n=this,a={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new K.Vector3;var o=new K.Vector3,r=a.NONE,i=a.NONE,s=new K.Vector3,c=new K.Vector2,l=new K.Vector2,u=new K.Vector3,d=0,m=new K.Vector2,p=new K.Vector2,h=0,g=0,f=new K.Vector2,v=new K.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var w={type:"change"},E={type:"start"},b={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}};var S=function(){var e=new K.Vector2;return function(t,a){return e.set((t-n.screen.left)/n.screen.width,(a-n.screen.top)/n.screen.height),e}}(),y=function(){var e=new K.Vector2;return function(t,a){return e.set((t-.5*n.screen.width-n.screen.left)/(.5*n.screen.width),(n.screen.height+2*(n.screen.top-a))/n.screen.width),e}}();function O(e){!1!==n.enabled&&(window.removeEventListener("keydown",O),i=r,r===a.NONE&&(e.keyCode!==n.keys[a.ROTATE]||n.noRotate?e.keyCode!==n.keys[a.ZOOM]||n.noZoom?e.keyCode!==n.keys[a.PAN]||n.noPan||(r=a.PAN):r=a.ZOOM:r=a.ROTATE))}function C(e){!1!==n.enabled&&(r=i,window.addEventListener("keydown",O,!1))}function j(e){!1!==n.enabled&&(e.preventDefault(),e.stopPropagation(),r===a.NONE&&(r=e.button),r!==a.ROTATE||n.noRotate?r!==a.ZOOM||n.noZoom?r!==a.PAN||n.noPan||(f.copy(S(e.pageX,e.pageY)),v.copy(f)):(m.copy(S(e.pageX,e.pageY)),p.copy(m)):(l.copy(y(e.pageX,e.pageY)),c.copy(l)),document.addEventListener("mousemove",I,!1),document.addEventListener("mouseup",N,!1),n.dispatchEvent(E))}function I(e){!1!==n.enabled&&(e.preventDefault(),e.stopPropagation(),r!==a.ROTATE||n.noRotate?r!==a.ZOOM||n.noZoom?r!==a.PAN||n.noPan||v.copy(S(e.pageX,e.pageY)):p.copy(S(e.pageX,e.pageY)):(c.copy(l),l.copy(y(e.pageX,e.pageY))))}function N(e){!1!==n.enabled&&(e.preventDefault(),e.stopPropagation(),r=a.NONE,document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",N),n.dispatchEvent(b))}function D(e){if(!1!==n.enabled&&!0!==n.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:m.y-=.025*e.deltaY;break;case 1:m.y-=.01*e.deltaY;break;default:m.y-=25e-5*e.deltaY}n.dispatchEvent(E),n.dispatchEvent(b)}}function k(e){if(!1!==n.enabled){switch(e.preventDefault(),e.touches.length){case 1:r=a.TOUCH_ROTATE,l.copy(y(e.touches[0].pageX,e.touches[0].pageY)),c.copy(l);break;default:r=a.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;g=h=Math.sqrt(t*t+o*o);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;f.copy(S(i,s)),v.copy(f)}n.dispatchEvent(E)}}function M(e){if(!1!==n.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:c.copy(l),l.copy(y(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,a=e.touches[0].pageY-e.touches[1].pageY;g=Math.sqrt(t*t+a*a);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;v.copy(S(o,r))}}function T(e){if(!1!==n.enabled){switch(e.touches.length){case 0:r=a.NONE;break;case 1:r=a.TOUCH_ROTATE,l.copy(y(e.touches[0].pageX,e.touches[0].pageY)),c.copy(l)}n.dispatchEvent(b)}}function x(e){!1!==n.enabled&&e.preventDefault()}this.rotateCamera=function(){var e,t=new K.Vector3,a=new K.Quaternion,o=new K.Vector3,r=new K.Vector3,i=new K.Vector3,m=new K.Vector3;return function(){m.set(l.x-c.x,l.y-c.y,0),(e=m.length())?(s.copy(n.object.position).sub(n.target),o.copy(s).normalize(),r.copy(n.object.up).normalize(),i.crossVectors(r,o).normalize(),r.setLength(l.y-c.y),i.setLength(l.x-c.x),m.copy(r.add(i)),t.crossVectors(m,s).normalize(),e*=n.rotateSpeed,a.setFromAxisAngle(t,e),s.applyQuaternion(a),n.object.up.applyQuaternion(a),u.copy(t),d=e):!n.staticMoving&&d&&(d*=Math.sqrt(1-n.dynamicDampingFactor),s.copy(n.object.position).sub(n.target),a.setFromAxisAngle(u,d),s.applyQuaternion(a),n.object.up.applyQuaternion(a)),c.copy(l)}}(),this.zoomCamera=function(){var e;r===a.TOUCH_ZOOM_PAN?(e=h/g,h=g,s.multiplyScalar(e)):(1!==(e=1+(p.y-m.y)*n.zoomSpeed)&&e>0&&s.multiplyScalar(e),n.staticMoving?m.copy(p):m.y+=(p.y-m.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=new K.Vector2,t=new K.Vector3,a=new K.Vector3;return function(){e.copy(v).sub(f),e.lengthSq()&&(e.multiplyScalar(s.length()*n.panSpeed),a.copy(s).cross(n.object.up).setLength(e.x),a.add(t.copy(n.object.up).setLength(e.y)),n.object.position.add(a),n.target.add(a),n.staticMoving?f.copy(v):f.add(e.subVectors(v,f).multiplyScalar(n.dynamicDampingFactor)))}}(),this.checkDistances=function(){n.noZoom&&n.noPan||(s.lengthSq()>n.maxDistance*n.maxDistance&&(n.object.position.addVectors(n.target,s.setLength(n.maxDistance)),m.copy(p)),s.lengthSq()<n.minDistance*n.minDistance&&(n.object.position.addVectors(n.target,s.setLength(n.minDistance)),m.copy(p)))},this.update=function(){s.subVectors(n.object.position,n.target),n.noRotate||n.rotateCamera(),n.noZoom||n.zoomCamera(),n.noPan||n.panCamera(),n.object.position.addVectors(n.target,s),n.checkDistances(),n.object.lookAt(n.target),o.distanceToSquared(n.object.position)>1e-6&&(n.dispatchEvent(w),o.copy(n.object.position))},this.reset=function(){r=a.NONE,i=a.NONE,n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.up.copy(n.up0),s.subVectors(n.object.position,n.target),n.object.lookAt(n.target),n.dispatchEvent(w),o.copy(n.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",x,!1),this.domElement.removeEventListener("mousedown",j,!1),this.domElement.removeEventListener("wheel",D,!1),this.domElement.removeEventListener("touchstart",k,!1),this.domElement.removeEventListener("touchend",T,!1),this.domElement.removeEventListener("touchmove",M,!1),document.removeEventListener("mousemove",I,!1),document.removeEventListener("mouseup",N,!1),window.removeEventListener("keydown",O,!1),window.removeEventListener("keyup",C,!1)},this.domElement.addEventListener("contextmenu",x,!1),this.domElement.addEventListener("mousedown",j,!1),this.domElement.addEventListener("wheel",D,!1),this.domElement.addEventListener("touchstart",k,!1),this.domElement.addEventListener("touchend",T,!1),this.domElement.addEventListener("touchmove",M,!1),window.addEventListener("keydown",O,!1),window.addEventListener("keyup",C,!1),this.handleResize(),this.update()},K.TrackballControls.prototype=Object.create(K.EventDispatcher.prototype),K.TrackballControls.prototype.constructor=K.TrackballControls;K.TrackballControls,n(239);n(21).config();var J,$=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).getImage=function(e){var t=[];return n.service.get("/spaces/".concat(e)).then(function(e){console.log(e.data.likes),n.setState({image:e.data.image,mediaIDs:e.data.media,likes:e.data.likes,owner:e.data.creator}),n.sendNewSpace(e.data)}).then(function(){return n.state.mediaIDs.forEach(function(e){"object"==typeof e&&(e=e._id),t.push(n.service.get("/media/".concat(e)))}),Promise.all(t)}).then(function(e){var t=[];e.forEach(function(e){t.push(e.data)}),n.setState({media:t})}).catch(function(e){return console.log(e)})},n.sendNewSpace=function(e){n.props.newSpace(e._id,e.location),n.props.newPage()},n.init=function(e){var t=e.camera,a=e.scene,o=e.renderer,r=e.sceneCSS,i=e.rendererCSS;n.setState({controls:new I(t)}),t.position.set(0,0,-.001),o.domElement.className="scope",i.domElement.className="scopeCSS";var s=new C.SphereBufferGeometry(n.state.spaceRadius,60,40);s.scale(-1,1,1);var c=new C.TextureLoader;c.crossOrigin="";var l=c.load(n.state.image),u=new C.MeshBasicMaterial({map:l}),d=new C.Mesh(s,u);a.add(d);var m,p=n.state.media,h=n.state.likes;void 0!==p&&(m=_(n.state.spaceRadius,p,h),r.add(m));var g=document.getElementById("scopediv");o.setPixelRatio(window.devicePixelRatio),o.setSize(window.innerWidth,window.innerHeight),g.appendChild(o.domElement),i.setSize(window.innerWidth,window.innerHeight),g.appendChild(i.domElement),window.addEventListener("resize",n.onWindowResize,!1)},n.animate=function(){var e=n.state,t=e.camera,a=e.scene,o=e.renderer,r=e.sceneCSS,i=e.rendererCSS,s=e.controls;window.requestAnimationFrame(n.animate),s.update(),o.render(a,t),i.render(r,t)},n.onWindowResize=function(){var e=n.state,t=e.camera,a=e.renderer,o=e.rendererCSS;t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight),o.setSize(window.innerWidth,window.innerHeight)},n.toogleModal=function(e){n.state.modal?(n.setState({modal:!1}),n.setState({menu:"MEDIA"})):(n.setState({modal:!0}),n.setState({menu:"MEDIA"}))},n.mediaMenu=function(e,t){n.setState({menu:t})},n.likeListener=function(){document.body.addEventListener("click",function(e){if("like-button"==e.target.id){var t=n.state.likes+1;n.setState({likes:t}),console.log(t);var a={likes:t,id:n.state.spaceID};return n.service.post("/spaces/like",{space:a}).then(function(e){console.log("Space updated on DB "+e.data)}).catch(function(e){return console.log(e)})}})},n.componentDidMount=function(){var e=n.props.match.params.id;n.setState({spaceID:e}),U().then(function(e){n.setState({currrentLocation:e})}),n.getImage(e).then(function(){n.init(n.state),n.animate()}).then(function(){n.likeListener()})},n.state={spaceRadius:500,camera:new C.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1100),scene:new C.Scene,sceneCSS:new C.Scene,renderer:new C.WebGLRenderer({antialias:!0}),rendererCSS:new D,isInLocation:!1,isLiked:!1,likes:0,modal:!1},n.service=E.a.create({baseURL:"".concat("https://in-situ.herokuapp.com","/api")}),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState(Object(g.a)({},this.state,{loggedInUser:e.userInSession}))}},{key:"render",value:function(){var e=this,t=this.props.match.params.id,n=this.state.likes;if(this.state.loggedInUser){var a=this.state.owner==this.state.loggedInUser._id;if(console.log(this.state.modal),console.log(this.state.menu),a&&!this.state.modal)return o.a.createElement("div",{id:"scopediv"},o.a.createElement("button",{className:"button is-white is-outlined is-rounded switch-button white"},o.a.createElement(f.a,{to:"/camera/".concat(t)},"AR")),o.a.createElement("button",{className:"button is-white is-outlined is-rounded likes-button white",onClick:function(t){return e.toogleModal(t)}},"Add Media"));if(a&&this.state.modal&&"IMAGE"==this.state.menu)return o.a.createElement("div",null,o.a.createElement("div",{className:"card box modal"},o.a.createElement(L,{userInSession:this.state.loggedInUser,currentSpace:this.state.spaceID})),o.a.createElement("div",{id:"scopediv"},o.a.createElement("button",{className:"button is-white is-outlined is-rounded switch-button white"},o.a.createElement(f.a,{to:"/camera/".concat(t)},"AR")),o.a.createElement("button",{className:"button is-white is-outlined is-rounded likes-button white",onClick:function(t){return e.toogleModal(t)}},"Add Media")));if(a&&this.state.modal&&"TEXT"==this.state.menu)return o.a.createElement("div",null,o.a.createElement("div",{className:"card box modal"},o.a.createElement(X,{userInSession:this.state.loggedInUser,currentSpace:this.state.spaceID})),o.a.createElement("div",{id:"scopediv"},o.a.createElement("button",{className:"button is-white is-outlined is-rounded switch-button white"},o.a.createElement(f.a,{to:"/camera/".concat(t)},"AR")),o.a.createElement("button",{className:"button is-white is-outlined is-rounded likes-button white",onClick:function(t){return e.toogleModal(t)}},"Add Media")));if(a&&this.state.modal&&"VIDEO"==this.state.menu)return o.a.createElement("div",null,o.a.createElement("div",{className:"card box modal"},o.a.createElement(Y,{userInSession:this.state.loggedInUser,currentSpace:this.state.spaceID})),o.a.createElement("div",{id:"scopediv"},o.a.createElement("button",{className:"button is-white is-outlined is-rounded switch-button white"},o.a.createElement(f.a,{to:"/camera/".concat(t)},"AR")),o.a.createElement("button",{className:"button is-white is-outlined is-rounded likes-button white",onClick:function(t){return e.toogleModal(t)}},"Add Media")));if(a&&this.state.modal&&"MEDIA"==this.state.menu)return o.a.createElement("div",null,o.a.createElement("div",{className:"card box modal"},o.a.createElement("button",{className:"button is-primary",onClick:function(t){return e.mediaMenu(t,"TEXT")}},"Add Text"),o.a.createElement("button",{className:"button is-primary",onClick:function(t){return e.mediaMenu(t,"IMAGE")}},"Add Image"),o.a.createElement("button",{className:"button is-primary",onClick:function(t){return e.mediaMenu(t,"VIDEO")}},"Add Video")),o.a.createElement("div",{id:"scopediv"},o.a.createElement("button",{className:"button is-white is-outlined is-rounded likes-button white",onClick:function(t){return e.toogleModal(t)}},"Add Media"),o.a.createElement("button",{className:"button is-white is-outlined is-rounded switch-button white"},o.a.createElement(f.a,{to:"/camera/".concat(t)},"AR"))))}return o.a.createElement("div",null,o.a.createElement("div",{id:"scopediv"},o.a.createElement("button",{className:"button is-white is-outlined is-rounded switch-button white"},o.a.createElement(f.a,{to:"/camera/".concat(t)},"AR")),o.a.createElement("button",{className:"button is-white is-outlined is-rounded likes-button white",disabled:!0},n," likes")))}}]),t}(o.a.Component),ee=n(109),te=n.n(ee),ne=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).init=function(e){var t=e.camera,a=e.scene,o=e.renderer;t.position.set(0,0,-100),o.domElement.className="welcome";var r=new C.SphereBufferGeometry(n.state.spaceRadius,100,40);r.scale(-1,1,1);var i=new C.MeshBasicMaterial({color:16777215,wireframe:!0,wireframeLinewidth:5});J=new C.Mesh(r,i),a.add(J),a.background=new C.Color(53682);var s=document.getElementById("welcome");o.setPixelRatio(window.devicePixelRatio),o.setSize(window.innerWidth,window.innerHeight),s.appendChild(o.domElement),window.addEventListener("resize",n.onWindowResize,!1)},n.animate=function(){var e=n.state,t=e.camera,a=e.scene,o=e.renderer;window.requestAnimationFrame(n.animate),J.rotation.x+=.0015,J.rotation.y+=.001,J.rotation.z+=4e-4,o.render(a,t)},n.onWindowResize=function(){var e=n.state,t=e.camera,a=e.renderer;t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight)},n.componentDidMount=function(){n.props.newPage(),n.init(n.state),n.animate()},n.state={spaceRadius:500,camera:new C.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1100),scene:new C.Scene,renderer:new C.WebGLRenderer({antialias:!0}),modal:!1},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"home"},o.a.createElement("img",{src:te.a,className:"logo"}),o.a.createElement("div",{id:"welcome",className:"welcome"}))}}]),t}(o.a.Component);n(21).config();var ae=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).getFeedScopes=function(){var e=n.state.loggedInUser.following,t=[],a=[],o=[],r=[],i=[],s=[],c=[],l=[];return e.forEach(function(e){r.push(n.service.get("/auth/u/".concat(e)))}),Promise.all(r).then(function(e){return e.forEach(function(e){t.push(e.data)}),t.forEach(function(e){var t=e.catalog;i.push(n.service.get("/catalog/".concat(t)))}),Promise.all(i).then(function(e){e.forEach(function(e){a.push(e.data.spaces)}),a.forEach(function(e){return c.push(e.length),e.forEach(function(e){s.push(n.service.get("/spaces/".concat(e)))}),Promise.all(s).then(function(e){t.forEach(function(e,t){for(var n=0;n<c[t];n++)l.push(e.username)}),e.forEach(function(e,t){var n={_id:e.data._id,image:e.data.image,username:l[t]};o.push(n)}),n.setState({feedSpaces:o}),console.log(c)})})}).catch(function(e){return console.log(e)})})},n.state={loggedInUser:e.userInSession},n.service=E.a.create({baseURL:"".concat("https://in-situ.herokuapp.com","/api")}),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState(Object(g.a)({},this.state,{loggedInUser:e.userInSession})),this.props.newPage()}},{key:"componentDidMount",value:function(){this.getFeedScopes()}},{key:"render",value:function(){var e=this.state.feedSpaces;return e?o.a.createElement("div",{className:"profile-feed"},e.map(function(e){return console.log(e),o.a.createElement("div",{key:e._id,className:"scope-in-feed"},o.a.createElement("p",{className:"feed-user"},e.username),o.a.createElement(f.a,{to:"/scope/".concat(e._id)},o.a.createElement("img",{className:"panorama-feed",height:"50px",src:e.image})))})):o.a.createElement("div",{className:"profile-feed"},o.a.createElement("h1",null,"Follow other users to see their Scopes"))}}]),t}(a.Component),oe=n(41),re=n(110),ie=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).onScriptLoad=n.onScriptLoad.bind(Object(oe.a)(Object(oe.a)(n))),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"onScriptLoad",value:function(){var e=new window.google.maps.Map(document.getElementById(this.props.id),this.props.options),t=new window.google.maps.StyledMapType(re.STYLES,{name:"MapStyled"});e.mapTypes.set("MapStyled",t),e.setMapTypeId("MapStyled"),this.props.onMapLoad(e)}},{key:"componentDidMount",value:function(){var e=this;if(window.google)this.onScriptLoad();else{var t=document.createElement("script");t.type="text/javascript",t.src="https://maps.google.com/maps/api/js?key=AIzaSyA2VCIDASPyZRdr58uKR5ucueARsagOD6s";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n),t.addEventListener("load",function(t){e.onScriptLoad()})}}},{key:"render",value:function(){return o.a.createElement("div",{style:{width:window.innerWidth,height:window.innerHeight},id:this.props.id})}}]),t}(a.Component),se=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).setRedirect=function(e){n.setState({redirect:!0,url:e})},n.getMarkers=function(){n.service.get("/spaces").then(function(e){n.setState({spaces:e.data})})},n.renderRedirect=function(){if(n.state.redirect){console.log(n.state.url);var e="/scope/".concat(n.state.url);return o.a.createElement(S.a,{to:e})}},n.state={redirect:!1},n.service=E.a.create({baseURL:"".concat("https://in-situ.herokuapp.com","/api")}),U().then(function(e){console.log(e),n.setState({location:e})}),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillMount",value:function(){this.getMarkers(),this.props.newPage()}},{key:"render",value:function(){var e=this,t=this.state.spaces;return t?o.a.createElement("div",null,this.renderRedirect(),o.a.createElement(ie,{id:"myMap",options:{center:this.state.location,zoom:12},onMapLoad:function(n){var a=[];t&&t.forEach(function(e){var t=new window.google.maps.Marker({position:e.location,map:n,icon:"./marker.png",url:e._id,title:"Scope near you!"});a.push(t)}),a.forEach(function(t){t.addListener("click",function(n){e.setRedirect(t.url),console.log(t.url)})})}})):o.a.createElement("div",null)}}]),t}(a.Component),ce=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(u.a)(this,Object(d.a)(t).call(this))).getTheUser=function(t){e.setState({loggedInUser:t})},e.logout=function(){e.service.logout().then(function(){e.setState({loggedInUser:null})})},e.actualizeSpace=function(t,n){e.setState({spaceId:t,spaceLocation:n})},e.state={loggedInUser:null,spaceId:"5bc3313fdd315804e045a573",spaceLocation:{lat:40.3923451,lng:-3.6985332999999994},page:"Home"},e.service=new b,e}return Object(m.a)(t,e),Object(l.a)(t,[{key:"fetchUser",value:function(){var e=this;null===this.state.loggedInUser&&this.service.loggedin().then(function(t){e.setState({loggedInUser:t})}).catch(function(t){e.setState({loggedInUser:!1})})}},{key:"render",value:function(){var e=this;return console.log("SPACE ID STATE APP"),console.log(this.state.spaceId),this.fetchUser(),o.a.createElement("div",{className:"App"},o.a.createElement("header",{className:"header"},o.a.createElement(v,Object(s.a)({userInSession:this.state.loggedInUser,page:this.state.page,logout:this.logout},"page",this.state.page))),o.a.createElement("div",{className:"fix-top"}),o.a.createElement("main",null,o.a.createElement(p.a,null,o.a.createElement(h.a,{exact:!0,path:"/",render:function(){return o.a.createElement(ne,{newPage:function(){e.setState({page:"Home"})}})}}),o.a.createElement(h.a,{exact:!0,path:"/feed",render:function(t){return o.a.createElement(ae,Object.assign({userInSession:e.state.loggedInUser,newPage:function(){e.setState({page:"Feed"})}},t))}}),o.a.createElement(h.a,{exact:!0,path:"/explore",render:function(t){return o.a.createElement(se,Object.assign({location:e.state.spaceLocation},t,{newPage:function(){e.setState({page:"Explore"})}}))}}),o.a.createElement(h.a,{exact:!0,path:"/signup",render:function(){return o.a.createElement(y,{getUser:e.getTheUser,newPage:function(){e.setState({page:"Home"})}})}}),o.a.createElement(h.a,{exact:!0,path:"/login",render:function(){return o.a.createElement(O,{getUser:e.getTheUser,newPage:function(){e.setState({page:"Home"})}})}}),o.a.createElement(h.a,{path:"/profile/:username",render:function(t){return o.a.createElement(Q,Object.assign({userInSession:e.state.loggedInUser,newPage:function(){e.setState({page:"ProfileID"})}},t))}}),o.a.createElement(h.a,{exact:!0,path:"/profile",render:function(){return o.a.createElement(Z,{userInSession:e.state.loggedInUser,newPage:function(){e.setState({page:"Profile"})}})}}),o.a.createElement(h.a,{path:"/scope/:id",render:function(t){return o.a.createElement($,Object.assign({userInSession:e.state.loggedInUser,newPage:function(){e.setState({page:"Scope"})},newSpace:function(t,n){e.actualizeSpace(t,n)}},t))}}),o.a.createElement(h.a,{exact:!0,path:"/camera/:id",render:function(t){return o.a.createElement(F,Object.assign({newPage:function(){e.setState({page:"Scope"})},newSpace:function(t,n){e.actualizeSpace(t,n)}},t))}}),o.a.createElement(h.a,{exact:!0,path:"/upload-scope",render:function(){return o.a.createElement(R,{newPage:function(){e.setState({page:"Upload"})},newSpace:function(t,n){e.actualizeSpace(t,n)},userInSession:e.state.loggedInUser})}}))),o.a.createElement("div",{className:"fix-bottom"}),o.a.createElement("footer",null,o.a.createElement(q,{userInSession:this.state.loggedInUser,page:this.state.page})))}}]),t}(a.Component),le=n(244);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(le.a,null,o.a.createElement(ce,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[111,2,1]]]);
//# sourceMappingURL=main.ef2e386b.chunk.js.map